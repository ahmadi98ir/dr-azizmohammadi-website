# ูุจุณุงุช ฺฉููฺฉ ุชุฑฺฉ ุงุนุชุงุฏ ู ูุดุงูุฑู ุฎุงููุงุฏู โ Next.js 15, Tailwind, TypeScript

ุงู ูพุฑูฺู ฺฉ ุงุณฺฉูุช ฺฉุงูู ุจุฑุง ูุจุณุงุช ฺฉููฺฉ ุฏฺฉุชุฑ ยซุณุฏ ูุฌุฏ ุนุฒุฒูุญูุฏยป ุงุณุช ุจุง ุงูฺฉุงูุงุช:

- ุซุจุชโูุงู ู ูุฑูุฏ ฺฉุงุฑุจุฑุงู (ุจูุงุฑุงู)
- ุฑุฒุฑู ููุจุช ุขููุงู (ูุฒุช/ูุดุงูุฑู)
- ฺฏูุชโูฺฏู ูุชู ุขููุงู ุจู ุจูุงุฑ ู ฺฉููฺฉ ุจุฑุง ูุฑ ููุจุช (real-time ุจุง SSE)
- ุจุฎุด ูุฏุฑุช (ุงุฏูู) ุจุฑุง ูุฏุฑุช ููุจุชโูุงุ ฺฉุงุฑุจุฑุงู ู ุงุนูุงูโูุง
- ุฑุงุจุท ูุงุฑุณุ ุฑุงุณุชโุจูโฺูพ ู ุณุจฺฉ ุจุง Tailwind CSS
- ุชูุงุณ ูุฏุฆู ูุจุชู ุจุฑ Jitsi (ุงูุฑู)
- ูพุฑุฏุงุฎุช ุดุจูโุณุงุฒโุดุฏู (Mock) ุจุง ฺฉุงูโุจฺฉ ู ุชุบุฑ ูุถุนุช ููุจุช
- CMS ุณุจฺฉ: ููุงูุงุช (Blog) ู ุณูุงูุงุช ูุชุฏุงูู (FAQ)
- ุซุจุชโูุงู ุจุง ุชุฃุฏ ุดูุงุฑู ููุจุงู (OTP): ุงุจุชุฏุง ุดูุงุฑู ููุจุงูุ ุณูพุณ ฺฉุฏ ุชุงุฏ ูพุงูฺฉุ ุณูพุณ ุชฺฉูู ุงุทูุงุนุงุช

> ุชูุฌู: ุจุฑุง ููููู ุงููู ุงุฒ ุฐุฎุฑูโุณุงุฒ ูุงู JSON ุฏุฑ ูพูุดู `data/` ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ุจุฑุง ูุญุท ูุงูุน ูพุดููุงุฏ ูโุดูุฏ ุงุฒ ูพุงฺฏุงูโุฏุงุฏู (ูุซูุงู PostgreSQL/SQLite ุจุง Prisma) ู ุณุฑูุณ ุงุญุฑุงุฒ ููุช ุญุฑููโุง ุงุณุชูุงุฏู ุดูุฏ.

## ุงุฌุฑุง ูุญู

1) ูุตุจ ูุงุจุณุชฺฏโูุง:

```bash
pnpm install
# ุง
npm install
```

2) ุงุฌุฑุง ูุญุท ุชูุณุนู:

```bash
pnpm dev
# ุง
npm run dev
```

3) ุขุฏุฑุณ ูพุดโูุฑุถ: `http://localhost:3000`

- ุงฺฉุงูุช ูุฏุฑ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุณุงุฎุชู ูโุดูุฏ:
  - ุงูู: `admin@clinic.local`
  - ุฑูุฒ ุนุจูุฑ: `admin1234`

## ุณุงุฎุชุงุฑ ูพูุดูโูุง

- `app/` ุตูุญุงุช ู API Routeูุง Next.js 15 (App Router)
- `lib/` ููุทู ุฏุงููู (ุงุญุฑุงุฒ ููุชุ ุณุดูุ ุฏุชุงุณุชูุฑ JSON)
- `data/` ูุงูโูุง ุฏุงุฏู (ุฏุฑ ุงุฌุฑุง ุณุงุฎุชู ูโุดููุฏ)
- `app/api/*` ุณุฑูุณโูุง REST ุจุฑุง Auth, Appointments, Messages
- `prisma/schema.prisma` ูุฏูโูุง Prisma (SQLite ูพุดโูุฑุถ)

## ูฺฉุงุช ูู

- ุงุญุฑุงุฒ ููุช: ุณุดู ูุจุชู ุจุฑ ฺฉูฺฉ (`session_token`) + ุฐุฎุฑู ุณุดู ุฏุฑ `data/sessions.json`.
- ุฑูุฒ ุนุจูุฑ: `scrypt` ุงุฒ ูุณุชู Node ุจุฑุง ูุด ู ุชุงุฏ.
- Middleware ููุท ูุฌูุฏ ฺฉูฺฉ ุฑุง ฺฺฉ ูโฺฉูุฏุ ฺฉูุชุฑู ุณุทุญ ุฏุณุชุฑุณ ููุง ุฏุฑ ุณุฑูุฑ ุงูุฌุงู ูโุดูุฏ.
- ฺฏูุชโูฺฏู: SSE ุจุง ูุณุฑ `/api/messages/[appointmentId]/stream` (fallback ุจู polling ุฏุฑ ฺฉูุงูุช).
- ูพุฑุฏุงุฎุช: API ุดุจูโุณุงุฒโุดุฏู `/api/payments/checkout` ู `/api/payments/callback` + ุตูุญู `/payments/mock`.
- ูุฏุฆู: ุตูุญู `/meet/[id]` ุจุง Jitsi (ุฏุงููู ูพุดโูุฑุถ: `meet.jit.si`).
- CMS: APIูุง `/api/posts` ู `/api/faq` ุจุง ุตูุญุงุช ูุฏุฑุช.

## ุฑุงูโุงูุฏุงุฒ Prisma (ุงุฎุชุงุฑ)

ุจุฑุง ููุงุฌุฑุช ุจู ูพุงฺฏุงูโุฏุงุฏู ูุงูุน (SQLite/PG) ุจุง Prisma:

1) ูุตุจ ูพฺฉุฌโูุง ู ุณุงุฎุช ฺฉูุงูุช:

```bash
npm install
npx prisma generate
# ุงุฌุงุฏ ุฏุชุงุจุณ SQLite ู ุฌุฏููโูุง
npx prisma migrate dev --name init
```

2) ูุนุงูโุณุงุฒ ุงุณุชูุงุฏู ุงุฒ Prisma ุฏุฑ Runtime:

ุฏุฑ `.env.local` ููุฏุงุฑ ุฒุฑ ุฑุง ุชูุธู ฺฉูุฏ:

```
USE_PRISMA=1
DATABASE_URL="file:./prisma/dev.db"
```

ุจุฑูุงูู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ Prisma ุงุณุชูุงุฏู ูโฺฉูุฏุ ุฏุฑ ุบุฑ ุงูโุตูุฑุช ุงุฒ JSON fallback ุงุณุชูุงุฏู ูโุดูุฏ.

## ุจูุจูุฏูุง ูพุดููุงุฏ (ฺฏุงูโูุง ุจุนุฏ)

- ููุงุฌุฑุช ุฏุชุงุณุชูุฑ ุจู Prisma + PostgreSQL/SQLite
- ูพุฑุฏุงุฎุช ุขููุงู ุจุฑุง ุฑุฒุฑู ููุจุช
- ููุชูฺฉุดู (ุงูู/ุงุณโุงูโุงุณ) ุชุงุฏ ููุจุช
- ุชูุงุณ ูุฏุฆู (WebRTC) ุจุง ุณฺฏูุงููฺฏ ุงูู ุง ุงุฏุบุงู Jitsi/Zoom (ูุณุฎู ุณุงุฏู Jitsi ุขูุงุฏู ุงุณุช)
- ูพูู ูุญุชูุง (ููุงูุงุช/ุจูุงฺฏุ ุณูุงูุงุช ูุชุฏุงูู)

## ูพฺฉุฑุจูุฏโูุง

- `NEXT_PUBLIC_BASE_URL` ุฑุง ุฏุฑ `.env.local` ุจุฑุง SSR ุซุงุจุช ุฏุฑ ุชููุฏ ุชูุธู ฺฉูุฏ. ูพุดโูุฑุถ ุชูุณุนู `http://localhost:3000` ุงุณุช.
- `USE_PRISMA=1` ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฏุชุงุจุณ Prisma (ุงุฎุชุงุฑ)
- `DATABASE_URL` ูุณุฑ ุฏุชุงุจุณ Prisma (ุจุฑุง SQLite/PG)
- `JITSI_DOMAIN` ุฏุงููู Jitsi (ูพุดโูุฑุถ `meet.jit.si`)
- `SMS_PROVIDER` ููุฏุงุฑ `smsir` ุจุฑุง ูุนุงูโุณุงุฒ ุงุฑุณุงู ูพุงูฺฉ ูุงูุน (ุฏุฑ ุบุฑ ุงูโุตูุฑุช mock)
- `SMSIR_SEND_URL` ุขุฏุฑุณ endpoint ุงุฑุณุงู ูพุงูฺฉ ุฏุฑ ูพูู sms.ir (ุทุจู ูุณุชูุฏุงุช ุณุฑูุณ ุดูุง)
- `SMSIR_API_KEY` ฺฉูุฏ API ุจุฑุง ูุฏุฑ (ูุงููุฏ `x-api-key`) ุง Authorization ุจุฑ ุญุณุจ ูพูู
- `SMSIR_LINE_NUMBER` ุดูุงุฑู ุฎุท ุงุฑุณุงู (ุฏุฑ ุตูุฑุช ูุงุฒ)
- `SMSIR_AUTH_BEARER` ุงฺฏุฑ ููุฏุงุฑ `1` ุจุงุดุฏุ ฺฉูุฏ ุจู ุตูุฑุช `Authorization: Bearer <key>` ุงุฑุณุงู ูโุดูุฏ
- `SMSIR_HEADER_NAME` ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ูุฏุฑ ุณูุงุฑุด (ูพุดโูุฑุถ: `x-api-key`)
- `SMSIR_PARAM_CODE_NAME` ูุงู ูพุงุฑุงูุชุฑ ฺฉุฏ ุฏุฑ ูุงูุจ (ultra-fast)
- `SMSIR_INCLUDE_TTL` ุงฺฏุฑ `0` ุจุงุดุฏุ ูพุงุฑุงูุชุฑ TTL ุจู ูุงูุจ ุงุถุงูู ููโุดูุฏ
- `REQUIRE_SAME_ORIGIN=1` ุงูุฒุงู ุงุฑุณุงู ุฏุฑุฎูุงุณุชโูุง ุงุฒ ฺฉ Origin ุจุฑุงุจุฑ ุจุง `NEXT_PUBLIC_BASE_URL` ุจุฑุง ุงููุช ุจุดุชุฑ
- `LOGIN_MAX_ATTEMPTS` ุญุฏุงฺฉุซุฑ ุชูุงุด ูุฑูุฏ ุฏุฑ ฑฐ ุฏููู (ูพุดโูุฑุถ ฒฐ)
- `OTP_MAX_ATTEMPTS` ุญุฏุงฺฉุซุฑ ุชูุงุด ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ (ูพุดโูุฑุถ ต)
- `ENABLE_ADMIN_TEST_ROUTES=0` ุบุฑูุนุงู ฺฉุฑุฏู ูุณุฑูุง ุชุณุช ุงุฏูู ุฏุฑ ุชููุฏ

ุชูุฌู: ุณุงุฎุชุงุฑ ุฏูู payload ู ูุฏุฑูุง ุจุงุฏ ูุทุงุจู ูุณุชูุฏุงุช sms.ir ุดูุง ุชูุธู ุดูุฏ. ุฏุฑ ูุงู `lib/sms.ts` ูโุชูุงูุฏ ุฏุฑ ุตูุฑุช ูุฒูู ฺฉูุฏูุง ุฑุง ุชุบุฑ ุฏูุฏ (ultra-fast/verify/bulk).

## ุซุจุชโูุงู OTP ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ

- ุฏุฑุฎูุงุณุช ฺฉุฏ: `POST /api/auth/otp/request` ุจุง ุจุฏูู `{ phone }` (ุงุนุชุจุงุฑุณูุฌ ุดูุงุฑู ู ุงุฑุณุงู SMS)
- ุชุงุฏ ฺฉุฏ: `POST /api/auth/otp/verify` ุจุง ุจุฏูู `{ phone, code }` (ุจุงุฒฺฏุฑุฏุงูุฏู `ticket`)
- ุชฺฉูู ุซุจุชโูุงู: `POST /api/auth/register` ุจุง ุจุฏูู `{ name, email, phone, password, otpTicket }`
- ุตูุญู `register` ุจู ุตูุฑุช ณ ูุฑุญููโุง ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช.

ูููู ุจุงุดุฏ ๐ฑ
